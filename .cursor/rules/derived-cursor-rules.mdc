---
description: AI rules derived by SpecStory from the project AI interaction history
globs: *
---

## PROJECT DOCUMENTATION & CONTEXT SYSTEM
- Project plans are documented in markdown files within the project directory. These files include stories, tasks, subtasks, features, and dependencies.
- The `ProjectPlan.md` file serves as context for the AI agent to ensure alignment with project goals and requirements. It is updated automatically when new features are added or tasks are completed.
- The project documentation should include setup instructions, prerequisites, installation guides, and usage examples.

## TECH STACK
- Android SDK (API level 21 or higher)
- Kotlin/Java
- Retrofit (version 2.9.0)
- OkHttp (version 4.9.1, 4.11.0, 4.9.3)
- Ollama Client Library
- Python for Android
- Chaquopy
- WebView
- Room Database
- GitHub Actions
- Java Development Kit (JDK) 11, 17
- Android Gradle Plugin (AGP) 7.4.2, 8.0.2, 8.1.4
- Gradle 7.5, 7.6.1, 8.0, 8.4, 7.5.1
- Kotlin 1.8.0, 1.8.20, 1.9.10, 1.8.10

## PROJECT STRUCTURE
- Standard Android project structure with `src/main/java/com/ai/chat` for Kotlin code, `src/main/res/layout` for layouts, and `src/main/res/values` for resources.
- The project structure follows a modular approach:
    - `api/`: API services for cloud LLMs.
    - `ollama/`: Ollama integration for local models.
    - `code/`: Code execution services.
    - `storage/`: File management services.
    - `error/`: Error resolution services.
    - `ui/`: Jupyter-like rendering.

## CODING STANDARDS
- Follow Kotlin coding conventions for Android development.
- API keys must be stored securely and not directly in the code. Consider using environment variables or secure storage mechanisms.
- When including Python code, use markdown formatting with ```python to delineate code blocks.
- Use `mavenCentral()` repository instead of `jcenter()` in `build.gradle` files.
- Ensure `gradle-wrapper.jar` is present in `gradle/wrapper/`.
- Ensure `gradlew.bat` is present for Windows compatibility.
- Update `build.gradle` files to use plugins block.

## NAMING CONVENTIONS

## ERROR HANDLING
- Implement comprehensive error handling for API calls, code execution, and file management.
- Provide user-friendly error messages and suggestions for fixes.

## DEBUGGING
- Use Android Studio's debugging tools for identifying and resolving issues.

## SECURITY
- Sanitize user inputs to prevent code injection attacks.
- Ensure secure storage of code files and API keys.

## WORKFLOW & RELEASE RULES
- Use GitHub Actions for automated builds and APK generation.
- The `build.yml` file in the `.github/workflows/` directory defines the workflow for building the APK.
- Before pushing to the main branch, ensure all code is tested and reviewed.
- The GitHub Actions workflow should be configured to build the APK upon pushing to the main branch. The generated APK should be uploaded as an artifact for easy download.
- The GitHub Actions workflow must:
    - Use `actions/checkout@v3`, `actions/checkout@v4`.
    - Use `actions/setup-java@v3`, `actions/setup-java@v4` with `distribution: 'temurin'`.
    - Use `android-actions/setup-android@v2`, `android-actions/setup-android@v3`.
    - Grant execute permission for `gradlew`.
    - Upload APK using `actions/upload-artifact@v3`, `actions/upload-artifact@v4`.